---
title: "Models pretest"
author: "Henrique Sposito and Livio Silva-Muller"
date: "2022-12-06"
output:
  pdf_document: default
  html_document: default
  fig_caption: yes
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(include = FALSE)
library(dplyr)
library(tidyr)
library(scales)
library(RColorBrewer)
library(stargazer)
library(kableExtra)
library(tibble)
library(readxl)
library(ggplot2)
library(gridExtra)
library(modelsummary)
library(plm)
Sys.setlocale("LC_ALL", "C")
options(stringsAsFactors = FALSE, scipen = 999)
```

```{r data, message=FALSE, warning=FALSE, include=FALSE}
# Load data
pop <- readRDS("~/Documents/GitHub/amazondef/Replication_files/BR_presid_speeches_final.Rds")
ama <- readRDS("~/Documents/GitHub/amazondef/Replication_files/final_data_as.Rds")
ama <- ama %>% select(-c(title, date, text, false_positives)) %>% rename (ei= "EI", sd= "SD")
AAI <- readRDS("~/Documents/GitHub/amazondef/Replication_files//AAI.Rds")
location_km <- read_excel("~/Documents/GitHub/amazondef/Replication_Files/location_km.xlsx") %>%
  select(-location_cat) %>%
  distinct()
ama <- left_join(ama, location_km, by = "location")
amazon_def_year <- readRDS("~/Documents/GitHub/amazondef/Replication_files//amazon_def_year.Rds")
amazon_def_year$year <- amazon_def_year$year + 1
adr <- data.frame(year = c(1985, 1986, 1987, 1988),
def_year = c(21.050, 21.050, 21.050, 21.050))
amazon_def_year <- rbind(adr, amazon_def_year) # Missing year data 
hp = data.frame(beg = c(1985, 1990, 1993, 1994, 2002, 2010, 2016, 2018),
                end = c(1990, 1993, 1994, 2002, 2010, 2016, 2018, 2022),
                label = c(1987, 1991, 1993, 1998, 2006, 2013, 2017, 2020),
                presid = c("Sarney", "Collor", "Franco", "Cardoso", "Lula",
                           "Rousseff", "Temer", "Bolsonaro"))
amazon_def_year$area <- amazon_def_year$def_year*1000
# Prepare data for problem-constructions
sov <- ama %>% 
  filter(sov==1) %>% 
  count(sov, year) %>%
  group_by(year) %>%
  select(-c(sov))%>%
  rename (sov = n)
ei <- ama %>% 
  filter(ei==1) %>% 
  count(ei, year) %>%
  group_by(year) %>%
  select(-c(ei))%>%
  rename (ei = n) %>%
  ungroup() %>%
  tibble::add_row(year = 2017, ei = 0) %>%
  tibble::add_row(year = 2018, ei = 0)
sd <- ama %>% 
  filter(sd==1) %>% 
  count(sd, year) %>%
  group_by(year) %>%
  select(-c(sd))%>%
  rename (sd = n)
con <- ama %>% 
  filter(con==1) %>% 
  count(con, year) %>%
  group_by(year) %>%
  select(-c(con))%>%
  rename (con = n)
other <- ama %>% 
  filter(other==1) %>% 
  count(other, year) %>%
  group_by(year) %>%
  select(-c(other))%>%
  rename (other = n)
temp <- ei %>% 
  left_join(other) %>% 
  left_join(con) %>% 
  left_join(sd) %>% 
  left_join(sov) %>% 
  replace(is.na(.), 0)
# Get mixed types in
ama_mx <-  ama %>%
  unite(mixed_type, sov:con, sep="_") %>%
  mutate(mx_cat = factor(case_when(mixed_type == '1_0_0_0' ~ "Pure National Sovereignty",
                                   mixed_type == '0_1_0_0' ~ "Pure Economic Integration", 
                                   mixed_type == '0_0_1_0' ~ "Pure Social Development",
                                   mixed_type == '0_0_0_1' ~ "Pure Environmental Conservation",
                                   mixed_type == '0_0_0_0' ~ "Other",
                                   mixed_type == '0_1_0_1' ~ "Economic Conservation",
                                   mixed_type == '0_1_1_0' ~ "Social Economic",
                                   mixed_type == '1_0_0_1' ~ "Sovereign Conservation",
                                   mixed_type == '0_1_1_1' ~ "Economic, Social,\nand Conservation",
                                   mixed_type == '1_1_0_0' ~ "Economic Sovereignty",
                                   mixed_type == '0_0_1_1' ~ "Social Conservation",
                                   grepl("1_0_1_0|1_0_1_0|1_0_1_1|1_1_0_1|1_1_1_0|1_1_1_1",
                                         mixed_type) ~ "Other Mixed-types"),
         levels = c("Pure Economic Integration", "Pure Environmental Conservation",
                    "Pure Social Development",
                    "Pure National Sovereignty", "Other", "Economic Conservation", 
                    "Social Economic", "Sovereign Conservation",
                    "Economic, Social,\nand Conservation",
                    "Economic Sovereignty", "Social Conservation", "Other Mixed-types")),
         mx_cat2 = case_when(grepl("Pure Economic Integration|Pure Environmental Conservation|
                                   |Pure Social Development|Pure National Sovereignty",
                                   mx_cat) ~ "Pure-types",
                             grepl("^Other$", mx_cat) ~ "Other",
                             grepl("Economic Conservation|Social Economic|Sovereign Conservation|
                                   |Economic, Social,\nand Conservation|Economic Sovereignty|
                                   |Social Conservation|Other Mixed-types",
                                   mx_cat) ~ "Mixed-types"),
        election_year = ifelse(grepl("1989|1994|1998|2002|2006|2010|2014|2018",
                                      year), 1, 0),
        peak_year = ifelse(grepl("1989|1992|2009|2015|2019", year), 1, 0),
        py_1989=ifelse(grepl("1989", year), 1, 0),
        py_1992=ifelse(grepl("1992", year), 1, 0),
        py_2009=ifelse(grepl("2009", year), 1, 0),
        py_2015=ifelse(grepl("2015", year), 1, 0),
        py_2019=ifelse(grepl("2019", year), 1, 0),
        location_cat = ifelse(grepl("parana|paraiba|mato grosso|mato grosso do sul",
                                     location, ignore.case = TRUE), # minor coding issues to fix
                               "Non Amazonian States", location_cat),
         location_cat = ifelse(grepl("paraguay", location, ignore.case = TRUE),
                               "International", location_cat), # minor coding issues to fix
         location_cat = factor(ifelse(grepl("Bolivia|Peru|Ecuador|Colombia|Venezuela|Guyana|Suriname",
                                            location), "Amazonian States",
                                      location_cat),
                               levels = c("Amazonian States",
                                          "International", "Brasilia",
                                          "Non Amazonian States")))

ama_model_lag <- dplyr::left_join(ama_mx, amazon_def_year, by = "year") %>%
dplyr::left_join(AAI, by = "year") %>%
filter(location_cat != "Non Identified", mx_cat != "Other Mixed-types") %>%
  mutate(con_vs_all = ifelse(mx_cat == "Pure Environmental Conservation", 1, 0),
         EI_vs_all = ifelse(mx_cat == "Pure Economic Integration", 1, 0),
         SD_vs_all = ifelse(mx_cat == "Pure Social Development", 1, 0),
         sov_vs_all = ifelse(mx_cat == "Pure National Sovereignty", 1, 0))

ama_model2_lag <- dplyr::select(pop, -text) %>%
  dplyr::left_join(amazon_def_year, by = "year") %>%
  dplyr::left_join(AAI, by = "year") %>%
  filter(location_cat != "Non Identified") %>%
  dplyr::mutate(location_cat = ifelse(grepl("parana|paraiba|mato grosso|mato grosso do sul", location, ignore.case = TRUE), "Non Amazonian States", location_cat),
         location_cat = ifelse(grepl("paraguay", location, ignore.case = TRUE),
                               "International", location_cat),
         location_cat = factor(ifelse(grepl("Bolivia|Peru|Ecuador|Colombia|Venezuela|Guyana|Suriname",
                                            location), "Amazonian Countries",
                                      location_cat),
                               levels = c("Amazonian States",
                                          "Amazonian Countries",
                                          "International", "Brasilia",
                                          "Non Amazonian States")),
         election_year = ifelse(grepl("1989|1994|1998|2002|2006|2010|2014|2018",
                                      year), 1, 0),
         peak_year = ifelse(grepl("1989|1992|2009|2015|2019", year), 1, 0))

#table(ama_model$president, ama_model$party)
#ideology_vdem <- readRDS("~/Documents/GitHub/amazondef/Submission/V-Dem-CPD-Party-V2.rds") %>% 
#dplyr::filter(country_name == "Brazil") %>%
#dplyr::select(v2pashname, v2xpa_antiplural, v2xpa_popul, v2pariglef) %>%
#tidyr::drop_na() %>%
#dplyr::rename(party = v2pashname) %>%
#group_by(party) %>%
#summarise(anti_pluralism = mean(v2xpa_antiplural),
#populism = mean(v2xpa_popul),
#left_right = mean(v2pariglef))
#ama_model_lag <- dplyr::left_join(ama_model_lag, ideology_vdem)
#ama_model2_lag <- dplyr::left_join(ama_model2_lag, ideology_vdem)

```


````{=tex}
\begin{landscape}

```{r models, fig.cap="Logistic Regressions without controls", echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, include=TRUE, results="asis"}

# model
a1 <- glm(con_vs_all ~ as.factor(location_cat),
family=binomial(link = "logit"),
                       data = ama_model_lag)
a2 <- glm(EI_vs_all ~ as.factor(location_cat),
family=binomial(link = "logit"),
                      data = ama_model_lag)
a3 <- glm(SD_vs_all ~ as.factor(location_cat),
                      family=binomial(link = "logit"), data = ama_model_lag)
a4 <- glm(sov_vs_all ~ as.factor(location_cat),
                       family=binomial(link = "logit"), data = ama_model_lag)

stargazer::stargazer(a1, a2, a3, a4, digits = 6, no.space = TRUE,
                     title = "Logistic regressions without controls")

```

\end{landscape}
````

````{=tex}
\begin{landscape}

```{r models lagged, fig.cap="Logistic Regressions with controls", echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, include=TRUE, results="asis"}

# model 2
b1 <- glm(con_vs_all ~ as.factor(location_cat) + def_year + AAI +
election_year + peak_year,
family=binomial(link = "logit"),
                       data = ama_model_lag)
b2 <- glm(EI_vs_all ~ as.factor(location_cat) + def_year + AAI +
election_year + peak_year,
family=binomial(link = "logit"),
                      data = ama_model_lag)
b3 <- glm(SD_vs_all ~ as.factor(location_cat) + def_year + AAI +
election_year + peak_year,
                      family=binomial(link = "logit"), data = ama_model_lag)
b4 <- glm(sov_vs_all ~ as.factor(location_cat) + def_year + AAI +
election_year + peak_year,
                       family=binomial(link = "logit"), data = ama_model_lag)

stargazer::stargazer(b1, b2, b3, b4, digits = 6, no.space = TRUE,
                     title = "Logistic regressions with controls")

```

\end{landscape}
````

````{=tex}
\begin{landscape}

```{r models president fixed effect, fig.cap="Fixed-effects logistic regressions by presidents with controls", echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, include=TRUE, results="asis"}

# model 3
c1 <- plm(con_vs_all ~ as.factor(location_cat) + 
                         def_year + AAI + election_year + peak_year,
                         data = ama_model_lag,
                         model = "within", index = "president")
c2 <- plm(EI_vs_all ~ as.factor(location_cat) +
                         def_year + AAI + election_year + peak_year,
                         data = ama_model_lag,
                         model = "within", index = "president")
c3 <- plm(SD_vs_all ~ as.factor(location_cat) +
                         def_year + AAI + election_year + peak_year,
                         data = ama_model_lag,
                         model = "within", index = "president")
c4 <- plm(sov_vs_all ~ as.factor(location_cat) +
                         def_year + AAI + election_year + peak_year,
                         data = ama_model_lag,
                         model = "within", index = "president")
                         
stargazer::stargazer(c1, c2, c3, c4, digits = 3, no.space = TRUE,
                     title = "Fixed-effects logistic regressions by president with controls",
                      column.sep.width = ".001pt",
                      font.size="small",
                      dep.var.labels = c("Environmental Conservation", "Economic Integration",
                                             "Social Development", "National Sovereignty"),
                          covariate.labels = c("Speech outside Brazil", "Speech in Brasilia", "Speech in Non-amazonian Brazilian States", "Yearly Deforestation", "Yearly Inflation", "Election Year", "Peak Year"))
```

\end{landscape}
````

````{=tex}
\begin{landscape}

```{r models president fixed effect w/ py, fig.cap="Fixed-effects logistic regressions by presidents with controls", echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, include=TRUE, results="asis"}

# model 3
c1 <- plm(con_vs_all ~ as.factor(location_cat) + 
                         def_year + AAI + election_year + py_1989+ py_1992+ py_2009+ py_2015+ py_2019,
                         data = ama_model_lag,
                         model = "within", index = "president")
c2 <- plm(EI_vs_all ~ as.factor(location_cat) +
                         def_year + AAI + election_year + py_1989+py_1992+py_2009+py_2015+py_2019,
                         data = ama_model_lag,
                         model = "within", index = "president")
c3 <- plm(SD_vs_all ~ as.factor(location_cat) +
                         def_year + AAI + election_year + py_1989+py_1992+py_2009+py_2015+py_2019,
                         data = ama_model_lag,
                         model = "within", index = "president")
c4 <- plm(sov_vs_all ~ as.factor(location_cat) +
                         def_year + AAI + election_year + py_1989+py_1992+py_2009+py_2015+py_2019,
                         data = ama_model_lag,
                         model = "within", index = "president")
                         
stargazer::stargazer(c1, c2, c3, c4, digits = 3, no.space = TRUE,
                     title = "Fixed-effects logistic regressions by president with controls and separate peak years",
                      column.sep.width = ".001pt",
                      font.size="small")
```

\end{landscape}
````
