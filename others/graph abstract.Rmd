---
title: "Graph abstract"
author: "Henrique Sposito"
date: "2/24/2022"
output: html_document
---

```{r}
library(dplyr)
library(ggplot2)
# Rename variables to adapt to text analysis packages' expectations
Amazon_speeches <- dplyr::rename(amazon_speeches_long, fulltext = text, text = AM2)
# Create the dictionary
sovereignty <- ("amazonia e brasileira|amazonia e nossa|soberania|soberana|soberano|interesse estrangeiro|ocupar|forcas armadas|patrimonio nacional|exercito|dono|internacionalizar|internacionalizacao")

economic_integration <- ("estrada|rodovia|hidroeletrica|desenvolv|balbina|itaipu|incentivos fiscais|integra|zona franca|transamazonica|madeira|porto|madeireira|energia|estimulo|banco|hidreletrica|convenio")

social_dev <- ("sede|fome|saude|hospital|escola|saneamento|social|comida|dign")

conservation <- ("preserv|conserv|determinacao|povos indigenas|demarcar|meio ambiente|protecao|proteg|renovavel|garantias ambientais|garantia ambiental|reduzir desmatamento|combate ao desmatamento|combater desmatamento|baixo carbono|limpa|direitos ambientais|unidades de conservacao")

# Create a variable for each and count matches
Amazon_speeches$sovereignty <- ifelse(stringr::str_detect(Amazon_speeches$text, paste0(sovereignty)), 1, 0)
Amazon_speeches$economic_integration <- ifelse(stringr::str_detect(Amazon_speeches$text, paste0(economic_integration)), 1, 0)
Amazon_speeches$social_dev <- ifelse(stringr::str_detect(Amazon_speeches$text, paste0(social_dev)), 1, 0)
Amazon_speeches$conservation <- ifelse(stringr::str_detect(Amazon_speeches$text, paste0(conservation)), 1, 0)
Amazon_speeches$other <- ifelse(Amazon_speeches$sovereignty == 0 & Amazon_speeches$economic_integration == 0 & 
                                  Amazon_speeches$conservation == 0 & Amazon_speeches$social_dev, 1, 0)

# Notice we count each match here, is that what we want? If not, see code chunk below.
# Visulaize totals
tibble::tibble(Sovereignty = sum(Amazon_speeches$sovereignty),
               EI = sum(Amazon_speeches$economic_integration),
               SD = sum(Amazon_speeches$social_dev),
               Conservation = sum(Amazon_speeches$conservation),
               Other = sum(Amazon_speeches$other))

# Visualize correlations
am_narratives <- Amazon_speeches %>%
  select(-c(text, fulltext, party, date, title)) %>%
  tidyr::pivot_longer(sovereignty:other) %>% 
  group_by(year, president, name) %>%
  summarise(value = sum(value)) %>%
  rename(narrative = name)

ggplot(am_narratives, aes(x = year, y = value , fill = narrative)) +
  geom_smooth(aes(group = narrative, color = narrative), size = 1, se = FALSE) +
  facet_wrap(~narrative, ncol = 2) +
  labs(x = "Year",
       y = "",
       title = "Narratives in Presidential Speeches per year since 1985 in Brazil")
```
