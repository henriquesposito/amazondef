---
title: "Analysis_hs"
output: html_document
date: '2022-03-28'
---

## Amazon as a problem in time

```{r}
# load some packages
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)

# Get datasets
final_data_as <- readRDS("~/Documents/GitHub/amazondef/final_data_as.Rds")

# Get the data per president (Plot 1)
time_long <- final_data_as %>% 
  mutate(sov = as.numeric(sov), EI = as.numeric(EI),
         SD = as.numeric(SD), con = as.numeric(con), other = as.numeric(other)) %>% 
  select(-c(ID, party, title, location, date, text, AM2, false_positives, hand_coded, location_cat)) %>%
  group_by(president, year) %>% 
  summarize(across(everything(), sum)) %>%
  tidyr::pivot_longer(sov:other, "Construction")
construction_time <- ggplot(time_long, aes(x = year, y = value, fill = Construction)) +
  geom_line(aes(group = Construction, color = Construction), size = 0.5) +
  labs(x = "",
       y = "",
       title = "How the Amazon has been constructed as a problem in time?") +
  theme_classic()
construction_time

# Let's try and add a labeled and colored rectangle for periods
hp = data.frame(beg = c(1985, 1990, 1993, 1994, 2002, 2010, 2016, 2018),
                end = c(1990, 1993, 1994, 2002, 2010, 2016, 2018, 2022),
                label = c(1987, 1991, 1993, 1998, 2006, 2013, 2017, 2020))
construction_time_color <- construction_time +
  annotate(geom = "rect", xmin = hp$beg, xmax = hp$end, ymin = -Inf, ymax = Inf, alpha = 0.2,
           color = c("blue", "green", "yellow", "cyan", "red", "purple", "brown", "grey"),
           fill = c("blue", "green", "yellow", "cyan", "red", "purple", "brown", "grey")) +
  annotate(geom = "text", x = hp$label, y = 150, angle = 90, alpha = 0.4, hjust = "left",
           label =  c("Sarney", "Collor", "Franco", "Cardoso", "Silva", "Rousseff", "Temer", "Bolsonaro"))
construction_time_color
# Maybe need to change colors a bit, but idea is there!
```

Plotting Amazon construction in time, without any normalization (the first two plot), appears to indicate that the frequencies for all constructions are rather consistent for the same years. That is, the frequencies in which the Amazon is constructed as different problems in time varies for across the years and for presidents, but within the same year presidents construct the Amazon as different issues with similar frequencies. Do all presidents construct the Amazon as diverse issues in rather consistent ways within the same year? Why then do we have variation in years? Could it be that the Amazon becomes a more important theme in some years than others?

Nevertheless, we do see some interesting patterns in time. For example, for Sarney and Collor it seems that the Amazon was constructed as an issue of conservation more than other constructions. This changes with Itamar who begins to focus on the Amazon as an issue of economic integration, this is accentuated for Cardoso. During the Silva years we see a switch from constructing the Amazon overwhelmingly as an issue of economic integration, in the first mandate, to focusing on conservation when talking about the Amazon by his second term. Rousseff constructs the Amazon mostly as an issue of social development. Temer appear to not mention the Amazon much in speeches, but keeps the focus on social development issues. Finally, for Bolsonaro, the Amazon is constructed as an issue of sovereignty and conservation.

```{r}
# Let's create a normalizing variable
# Say we will use the number of characters for all speeches in the large dataset for that year.
BR_presid_speeches_final <- readRDS("~/Documents/GitHub/amazondef/BR_presid_speeches_final.Rds")
normalization <- BR_presid_speeches_final %>% 
  select(c(text, year, president)) %>%
  mutate(char = nchar(text)) %>% 
  select(-text) %>% 
  group_by(year, president) %>% 
  summarize(across(everything(), sum)) %>% 
  mutate(char = char/10000) %>% 
  arrange(year)
time_long_norm <- final_data_as %>% 
  mutate(sov = as.numeric(sov), EI = as.numeric(EI),
         SD = as.numeric(SD), con = as.numeric(con), other = as.numeric(other)) %>% 
  select(-c(ID, party, title, location, date, text, AM2, false_positives, hand_coded, location_cat)) %>%
  group_by(president, year) %>% 
  summarize(across(everything(), sum)) %>% 
  arrange(year)
time_long_norm$char <- normalization$char
time_long_norm <- time_long_norm %>% 
  mutate(sov = sov/char,
         EI = EI/char,
         SD = SD/char,
         con = con/char) %>% 
  select(-c(char, other)) %>% 
  tidyr::pivot_longer(sov:con, "Construction")
construction_time_norm <- ggplot(time_long_norm, aes(x = year, y = value, fill = Construction)) +
  geom_line(aes(group = Construction, color = Construction), size = 0.5) +
  labs(x = "",
       y = "",
       title = "How the Amazon has been constructed as a problem in time?",
       subtitle = "Normalized by the number of characters in all speeches for respective year") +
  theme_classic()
construction_time_norm
# This changes things a bit!
# Let's add some colors as before
construction_time_norm_color <- construction_time_norm +
  annotate(geom = "rect", xmin = hp$beg, xmax = hp$end, ymin = -Inf, ymax = Inf, alpha = 0.2,
           color = c("blue", "green", "yellow", "cyan", "red", "purple", "brown", "grey"),
           fill = c("blue", "green", "yellow", "cyan", "red", "purple", "brown", "grey")) +
  annotate(geom = "text", x = hp$label, y = 2, angle = 90, alpha = 0.4, hjust = "left",
           label =  c("Sarney", "Collor", "Franco", "Cardoso", "Silva", "Rousseff", "Temer", "Bolsonaro"))
construction_time_norm_color
```

Now things have changed a bit. We see that when normalized for all the characters in all speeches by a president for a respective year, we see huge increases in the proportion in which the Amazon was constructed as problem by presidents for Sarney, Collor/Franco and Bolsonaro. Sarney was the first democratic (elected indirectly) president after the military dictatorship and it was during his administrations that the fires at the Amazon forest made international news. Collor was president of Brazil during the Rio climate conference in 1992, but was impeached that year. Franco, the vice president for Collor, took over at the was president of Brazil at the end of 1992. From 1992 onward, it appears that the Amazon became a less crucial topic in presidential discourse.

## Amazon as a problem by speaker

```{r}
# Let's get a table by president normalized
president <- time_long_norm %>%
  group_by(president, Construction) %>% 
  summarise(value = sum(value))
# Normalize by years in power
president$value_norm <- ifelse(president$president == "Bolsonaro", president$value/3, president$value)
president$value_norm <- ifelse(president$president == "Temer", president$value/2.5, president$value_norm)
president$value_norm <- ifelse(president$president == "Dilma", president$value/5.5, president$value_norm)
president$value_norm <- ifelse(president$president == "Lula", president$value/8, president$value_norm)
president$value_norm <- ifelse(president$president == "FHC", president$value/8, president$value_norm)
president$value_norm <- ifelse(president$president == "Itamar", president$value/2, president$value_norm)
president$value_norm <- ifelse(president$president == "Collor", president$value/2, president$value_norm)
president$value_norm <- ifelse(president$president == "Sarney", president$value/5, president$value_norm)
# Let's get the order right
president$order <- ifelse(president$president == "Bolsonaro", 1, 0)
president$order <- ifelse(president$president == "Temer", 2, president$order)
president$order <- ifelse(president$president == "Dilma", 3, president$order)
president$order <- ifelse(president$president == "Lula", 4, president$order)
president$order <- ifelse(president$president == "FHC", 5, president$order)
president$order <- ifelse(president$president == "Itamar", 6, president$order)
president$order <- ifelse(president$president == "Collor", 7, president$order)
president$order <- ifelse(president$president == "Sarney", 8, president$order)
# Let's get a filled bar plot
presid_construction <- ggplot(president, aes(reorder(president, -order), value, fill = Construction)) +
  geom_bar(position = "stack", stat = "identity") +
  geom_text(aes(label = round(value, 1)), vjust = 1, hjust = 1.2, position = "stack") +
  labs(x = "President",
       y = "Value (normalized)",
       title = "How the Amazon has been constructed as a problem by presidents?",
       subtitle = "Normalized by the number of characters in all speeches for respective year and time in power") +
  theme_classic() +
  coord_flip()
presid_construction
```

At first site, this tells us a story that is consistent with the graphs above that most presidents are fairly consistent in using several constructions to talk about the Amazon in similar frequencies. However, this figure tells us something interesting about which presidents proportionally talked more about the Amazon as a problem in speeches, that is Sarney, Cardoso, and Bolsonaro. We see that for Sarney the Amazon was overwhelmingly and issue of both conservation and economic development while for Cardoso the Amazon is constructed mostly as an issue of economic integration. For Bolsonaro, issues of conservation, economic development, and sovereignty are the most salient constructions with social development much behind.

## Amazon as a problem by location

```{r}
location <- final_data_as %>% 
  mutate(sov = as.numeric(sov), EI = as.numeric(EI),
         SD = as.numeric(SD), con = as.numeric(con)) %>% 
  select(-c(president, ID, party, title, location, date, text, AM2, false_positives, hand_coded, other)) %>%
  group_by(year, location_cat) %>% 
  summarize(across(everything(), sum)) %>%
  tidyr::pivot_longer(sov:con, "Construction")
# plot
location_time <- ggplot(location, aes(x = year, y = value, fill = location_cat)) +
  geom_smooth(aes(group = location_cat, color = location_cat), size = 1, se = FALSE) +
  facet_wrap(~ Construction, ncol = 1) +
  labs(x = "",
       y = "",
       title = "How the Amazon has been constructed as a problem across locations?") +
  theme_classic()
location_time
# Maybe the oposite is better
location_time_reverse <- ggplot(location, aes(x = year, y = value, fill = Construction)) +
  geom_smooth(aes(group = Construction, color = Construction), size = 1, se = FALSE) +
  facet_wrap(~ location_cat, ncol = 1) +
  labs(x = "",
       y = "",
       title = "How the Amazon has been constructed as a problem across locations?") +
  theme_classic()
location_time_reverse
```

Consistency is the right word here... Not much to say though before it is normilized...

## A bit of modelling, just in case

```{r}
# load package
library(plm)
library(stargazer)
# get data
model_norm <- final_data_as %>% 
  mutate(sov = as.numeric(sov), EI = as.numeric(EI),
         SD = as.numeric(SD), con = as.numeric(con), other = as.numeric(other)) %>% 
  select(-c(ID, party, title, location, date, text, AM2, false_positives, hand_coded)) %>%
  group_by(president, year, location_cat) %>% 
  summarize(across(everything(), sum)) %>% 
  arrange(year)
normalization_model <- BR_presid_speeches_final %>% 
  select(c(text, year, president, location_cat)) %>%
  mutate(char = nchar(text)) %>% 
  select(-text) %>% 
  group_by(year, president, location_cat) %>% 
  summarize(across(everything(), sum)) %>% 
  mutate(char = char/10000) %>% 
  arrange(year)
model_norm <- dplyr::left_join(model_norm, normalization_model, by = c("year", "president", "location_cat"))
model_norm <- model_norm %>% 
  mutate(sov = sov/char,
         EI = EI/char,
         SD = SD/char,
         con = con/char) %>% 
  select(-c(char, other)) %>% 
  tidyr::pivot_longer(sov:con, "Construction")

model_po <- plm(value ~ as.factor(president) + as.factor(location_cat) + as.factor(Construction),
                data = model_norm, model = "pooling", index = "year")
summary(model_po)
# model_re <- plm(value ~ as.factor(president) + as.factor(location_cat) + as.factor(Construction),
#                 data = model_norm, model = "random", index = "year")
# summary(model_re) # not working for some reason
# model_fe <- plm(value ~ as.factor(president) + as.factor(location_cat) + as.factor(Construction),
#                 data = model_norm, model = "within", index = "year")
# summary(model_fe)
stargazer::stargazer(model_po, type = "text", align=TRUE)
```

So, location matters more than construction and president in many ways?!?
